@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor

@{
    var language = HttpContextAccessor.HttpContext.Request.Cookies["FormLanguage"].ToString();
}

<fieldset>
    <legend>
        @if (language == "1")
        {<span>অনাপত্তি পত্র</span>}
        else
        {<span>No Objection Certificate</span>}
    </legend>

    <div class="col-md-6 form-group d-none">
        <label>
            @if (language == "1")
            {<span>এনওসি টাইপ</span>}
            else
            {<span>NOC Type</span>}
        </label>
        <div class="input-group">
            <select id="NocTypeId" name="NocTypeId" class="custom-select">
                @if (language == "1")
                {
                    <option value="">পছন্দ করুন...</option>
                    <option value="1">জেলা আইডব্লিউআরএম কমিটি থেকে এনওসি</option>
                    <option value="2">উপজেলা আইডব্লিউআরএম কমিটি</option>
                    <option value="3">ইউনিয়ন আইডব্লিউআরএম কমিটি</option>
                }
                else
                {
                    <option value="">Choose...</option>
                    <option value="1">NOC from District IWRM Committee</option>
                    <option value="2">Upazila IWRM Committee</option>
                    <option value="3">Union IWRM Committee</option>
                }
            </select>
        </div>
    </div>

    <div class="col-md-6 form-group">
        <label for="NocFileName">
            @if (language == "1")
            {<span>স্থানীয় কর্তৃপক্ষ অনাপত্তি পত্র (NOC) (প্রযোজ্য ক্ষেত্রে)</span>}
            else
            {<span>Letter of NOC from Local Authority (if applicable)</span>}
        </label>
        <div class="input-group">
            <div class="custom-file">
                <input id="NocFileName" name="NocFileName" type="file" class="custom-file-input"
                       onchange="UploadCommonFiles(this, 'NocFileName');">
                <label class="custom-file-label" for="NocFileName">
                    @if (language == "1")
                    {<span>ফাইল পছন্দ করুন</span>}
                    else
                    {<span>Choose file</span>}
                </label>
            </div>

            <a id="NocFileNameView" href="javascript:void(0);" target="_blank" class="btn btn-blue ml-2 text-white"></a>
        </div>
    </div>
</fieldset>

<hr />

<fieldset>
    <legend>
        @if (language == "1")
        {<span>টাকা প্রদান</span>}
        else
        {<span>Payments</span>}
    </legend>

    <div class="col-md-6 form-group">
        <label>
            @if (language == "1")
            {<span>পেমেন্টের ধরন</span>}
            else
            {<span>Payment Type</span>}
        </label>
        <div class="input-group">
            <select id="PaymentMethodId" name="PaymentMethodId" class="custom-select">
                @if (language == "1")
                {
                    <option>নির্বাচন করুন...</option>
                    <option value="1">চালান নম্বর</option>
                    <option value="2">ব্যাঙ্ক ড্রাফট</option>
                    <option value="3">পে অর্ডার নং</option>
                }
                else
                {
                    <option>Choose...</option>
                    <option value="1">Chalan Number</option>
                    <option value="2">Bank Draft</option>
                    <option value="3">Pay Order No</option>
                }
            </select>
        </div>
    </div>

    <div class="col-md-6 form-group">
        <label for="PaymentDocNumber">
            @if (language == "1")
            {<span>পেমেন্ট ডকুমেন্ট নম্বর</span>}
            else
            {<span>Payment Document Number</span>}
        </label>
        <div class="input-group">
            <div class="custom-file">
                <input id="PaymentDocNumber" name="PaymentDocNumber" type="text" class="form-control">
            </div>
        </div>
    </div>

    <div class="col-md-6 form-group">
        <label for="PaidAmount">
            @if (language == "1")
            {<span>পরিশোধের পরিমান</span>}
            else
            {<span>Paid Amount</span>}
        </label>
        <div class="input-group">
            <div class="custom-file">
                <input id="PaidAmount" name="PaidAmount" type="number" min="0" class="form-control text-right">
            </div>
        </div>
    </div>

    <div class="col-md-6 form-group">
        <label for="PaymentDate">
            @if (language == "1")
            {<span>টাকা প্রদানের তারিখ</span>}
            else
            {<span>Payment Date</span>}
        </label>
        <div class="input-group">
            <div class="custom-file">
                <input id="PaymentDate" name="PaymentDate" type="text" class="form-control datetimepicker" required>
            </div>
        </div>
    </div>

    <div class="col-md-6 form-group">
        <label for="PaymentDocFileName">
            @if (language == "1")
            {<span>পেমেন্ট ডকুমেন্ট ফাইল আপলোড করুন</span>}
            else
            {<span>Payment Document File</span>}
        </label>
        <div class="input-group">
            <div class="custom-file">
                <input id="PaymentDocFileName" name="PaymentDocFileName" type="file" class="custom-file-input"
                       onchange="UploadCommonFiles(this, 'PaymentDocFileName');">
                <label class="custom-file-label" for="PaymentDocFileName">
                    @if (language == "1")
                    {<span>ফাইল পছন্দ করুন</span>}
                    else
                    {<span>Choose file</span>}
                </label>
            </div>

            <a id="PaymentDocFileNameView" href="javascript:void(0);" target="_blank" class="btn btn-blue ml-2 text-white"></a>
        </div>
    </div>
</fieldset>

<fieldset class="hidden">
    <legend>
        @if (language == "1")
        {<span>সুপারিশ</span>}
        else
        {<span>Recommendation</span>}
    </legend>

    <div class="form-group">
        <label for="RecommendationId">
            @if (language == "1")
            {<span>সুপারিশ</span>}
            else
            {<span>Recommendation</span>}
        </label>
        <select id="RecommendationId" name="RecommendationId" class="form-control" required="">
            <option value="">
                @if (language == "1")
                {<span>বাছাই করুন...</span>}
                else
                {<span>Choose...</span>}
            </option>

            @{
                List<LookUpCcModRecommendation> _rec = ViewBag.RecommendationId;

                if (_rec.Count > 0)
                {
                    foreach (LookUpCcModRecommendation rec in _rec)
                    {
                        if (language == "1")
                        {
                            <option value="@rec.RecommendationId">@rec.RecommendationTitleBn</option>
                        }
                        else
                        {
                            <option value="@rec.RecommendationId">@rec.RecommendationTitle</option>
                        }
                    }
                }
            }
        </select>
    </div>

    <div class="form-group">
        <label for="RecommendationComment">
            @if (language == "1")
            {<span>শর্তাধীন</span>}
            else
            {<span>Conditional</span>}
        </label>
        <input type="text" id="RecommendationComment" name="RecommendationComment" class="form-control" />
    </div>

    <br />
</fieldset>

<fieldset>
    <legend>
        @if (language == "1")
        {<span>স্বাক্ষর সহ প্রতিষ্ঠান প্রধানের প্রত্যয়ন পত্র</span>}
        else
        {<span>Attested letter from head of the organization including Signature</span>}
    </legend>

    <div class="col-md-6 form-group">
        <label for="OrgHeadAttestedLetterFile">
            @if (language == "1")
            {<span>পত্র আপলোড</span>}
            else
            {<span>Upload Letter</span>}
        </label>
        <div class="input-group">
            <div class="custom-file">
                <input id="OrgHeadAttestedLetterFile" name="OrgHeadAttestedLetterFile" type="file" class="custom-file-input"
                       onchange="UploadCommonFiles(this, 'OrgHeadAttestedLetterFile');">
                <label class="custom-file-label" for="OrgHeadAttestedLetterFile">
                    @if (language == "1")
                    {<span>ফাইল পছন্দ করুন</span>}
                    else
                    {<span>Choose file</span>}
                </label>
            </div>

            <a id="OrgHeadAttestedLetterFileView" href="javascript:void(0);" target="_blank" class="btn btn-blue ml-2 text-white"></a>
        </div>
    </div>
</fieldset>
<hr />

<div class="form-group mb-0">
    <button id="btnSaveAdministrative" type="button" class="btn btn-info waves-effect waves-light">
        <span class="btn-label"><i class="mdi mdi-content-save"></i></span>
        @if (language == "1")
        {<span>সংরক্ষণ করুন</span> }
        else
        { <span>Save</span>}
        <span class="myspinner spinner-border spinner-border-sm mr-1 d-none"></span>
    </button>

    <button id="btnClearAdministrative" type="button" class="btn btn-danger waves-effect waves-light">
        <span class="btn-label"><i class="mdi mdi-close-outline"></i></span>
        @if (language == "1")
        {<span>পরিষ্কার করুন</span> }
        else
        { <span>Clear</span>}
    </button>
</div>

<script id="AdministrativeControls" type="text/javascript">
    jQuery(document).ready(function () {
        jQuery("#btnSaveAdministrative").click(function () {
            var _recDetail = {
                "ProjectId": GetHiddenValue('ProjectId'),
                "NocTypeId": jQuery('#NocTypeId option:selected').val(),
                "PaymentMethodId": jQuery('#PaymentMethodId option:selected').val(),
                "PaymentDocNumber": GetTextValue('PaymentDocNumber'),
                "PaidAmount": GetTextValue('PaidAmount'),
				"PaymentDate": GetTextValue('PaymentDate')
                //"RecommendationId": jQuery('#RecommendationId option:selected').val(),
                //"RecommendationComment": GetTextValue('RecommendationComment')
            };

            //console.log(_recDetail);

            var url = '@Url.Action("afrds", "form")';
            jQuery.ajax({
                type: "POST",
                url: url,
                data: { _recDetail: _recDetail },
                dataType: "json",
                success: function (data, status, jqXHR) {
                    if (data.status == 'success') {
                        Notification('success', 'Success', data.message);
                    } else {
                        Notification('error', 'Saving Error', data.message);
                    }
                }, error: function (jqXHR, exception) {
                    var errorMsg = AjaxErrorHandle(jqXHR, exception);
                    Notification('error', 'Error Occured', errorMsg);
                }
            });
        });

        jQuery("#btnClearAdministrative").click(function () {
            Swal.fire({
                title: "Are you sure?",
                text: "You won't be able to revert this!",
                type: "warning",
                allowEscapeKey: false,
                allowOutsideClick: false,
                showCancelButton: !0,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Sure"
            }).then(function (t) {
                t.value && Swal.fire("Cleared!", "Your entry data has been cleared successfully.", "success")
            });
        });
    });

    function AdminBindData() {
        var admin_bind_pid = '@Html.Raw(ViewBag.ProjectCommonDetail.ProjectId)';

        if (admin_bind_pid != '') {
            console.log('Form 31 Project ' + admin_bind_pid + ' Administrative Info Loading');

            SetDropdownValue('NocTypeId', '@Html.Raw(ViewBag.ProjectCommonDetail.NocTypeId)');
            var noc_file = '@Html.Raw(ViewBag.ProjectCommonDetail.NocFileName)';
            if(noc_file != ''){
	            $("#NocFileNameView").attr('href', '../images/CommonDetails/NocFiles/' + noc_file).text(noc_file);
            } else {
	            $("#NocFileNameView").attr('href', 'javascript:void(0);').text('No File');
            }

            SetDropdownValue('PaymentMethodId', '@Html.Raw(ViewBag.ProjectCommonDetail.PaymentMethodId)');
            SetTextValue('PaymentDocNumber', '@Html.Raw(ViewBag.ProjectCommonDetail.PaymentDocNumber)');
            SetTextValue('PaidAmount', '@Html.Raw(ViewBag.ProjectCommonDetail.PaidAmount)');
            SetTextValue('PaymentDate', '@Html.Raw(ViewBag.ProjectCommonDetail.PaymentDate)');

            var pay_file = '@Html.Raw(ViewBag.ProjectCommonDetail.PaymentDocFileName)';
            if(pay_file != ''){
	            $("#PaymentDocFileNameView").attr('href', '../images/CommonDetails/PayDocFiles/' + pay_file).text(pay_file);
            } else {
	            $("#PaymentDocFileNameView").attr('href', 'javascript:void(0);').text('No File');
            }

            var ohal_file = '@Html.Raw(ViewBag.ProjectCommonDetail.OrgHeadAttestedLetterFile)';
            if(ohal_file != ''){
	            $("#OrgHeadAttestedLetterFileView").attr('href', '../images/CommonDetails/OrgHeadAttstLtrFiles/' + ohal_file).text(ohal_file);
            } else {
	            $("#OrgHeadAttestedLetterFileView").attr('href', 'javascript:void(0);').text('No File');
            }
        }
    }
</script>